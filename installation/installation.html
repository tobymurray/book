<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Installation - The Rust on ESP Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="A comprehensive guide on using the Rust programming language with Espressif SoCs and modules">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../overview/index.html"><strong aria-hidden="true">2.</strong> Ecosystem Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../overview/using-the-standard-library.html"><strong aria-hidden="true">2.1.</strong> Using the Standard Library (std)</a></li><li class="chapter-item expanded "><a href="../overview/bare-metal.html"><strong aria-hidden="true">2.2.</strong> Bare Metal (no_std)</a></li><li class="chapter-item expanded "><a href="../overview/comparing-std-and-no_std.html"><strong aria-hidden="true">2.3.</strong> Comparing std and no_std</a></li></ol></li><li class="chapter-item expanded "><a href="../installation/index.html"><strong aria-hidden="true">3.</strong> Rust on ESP targets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../installation/installation.html" class="active"><strong aria-hidden="true">3.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../installation/troubleshooting.html"><strong aria-hidden="true">3.2.</strong> Troubleshooting</a></li></ol></li><li class="chapter-item expanded "><a href="../tooling/index.html"><strong aria-hidden="true">4.</strong> Tooling</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tooling/text-editors-and-ides.html"><strong aria-hidden="true">4.1.</strong> Text Editors and IDEs</a></li><li class="chapter-item expanded "><a href="../tooling/espflash.html"><strong aria-hidden="true">4.2.</strong> espflash</a></li><li class="chapter-item expanded "><a href="../tooling/espmonitor.html"><strong aria-hidden="true">4.3.</strong> espmonitor</a></li><li class="chapter-item expanded "><a href="../tooling/debugging/index.html"><strong aria-hidden="true">4.4.</strong> Debugging</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tooling/debugging/probe-rs.html"><strong aria-hidden="true">4.4.1.</strong> probe-rs</a></li><li class="chapter-item expanded "><a href="../tooling/debugging/openocd.html"><strong aria-hidden="true">4.4.2.</strong> OpenOCD</a></li><li class="chapter-item expanded "><a href="../tooling/debugging/vscode-debugging.html"><strong aria-hidden="true">4.4.3.</strong> Debugging in Visual Studio Code</a></li></ol></li><li class="chapter-item expanded "><a href="../tooling/simulating/index.html"><strong aria-hidden="true">4.5.</strong> Simulating</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tooling/simulating/wokwi.html"><strong aria-hidden="true">4.5.1.</strong> Wokwi</a></li><li class="chapter-item expanded "><a href="../tooling/simulating/qemu.html"><strong aria-hidden="true">4.5.2.</strong> QEMU</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../writing-your-own-application/index.html"><strong aria-hidden="true">5.</strong> Writing Your Own Application</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing-your-own-application/generate-project-from-template.html"><strong aria-hidden="true">5.1.</strong> Generating Projects from Templates</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/index.html"><strong aria-hidden="true">5.2.</strong> Writing no_std Applications</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/understanding-esp-template.html"><strong aria-hidden="true">5.2.1.</strong> Understanding esp-template</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/hello-world.html"><strong aria-hidden="true">5.2.2.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/panic.html"><strong aria-hidden="true">5.2.3.</strong> Panic!</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/blinky.html"><strong aria-hidden="true">5.2.4.</strong> Blinky</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/button.html"><strong aria-hidden="true">5.2.5.</strong> Detect a button press</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/interrupt.html"><strong aria-hidden="true">5.2.6.</strong> Detect a button press with interrupt</a></li></ol></li><li class="chapter-item expanded "><a href="../writing-your-own-application/std-applications/index.html"><strong aria-hidden="true">5.3.</strong> Writing std Applications</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing-your-own-application/std-applications/understanding-esp-idf-template.html"><strong aria-hidden="true">5.3.1.</strong> Understanding esp-idf-template</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../resources.html"><strong aria-hidden="true">6.</strong> Resources</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../misc/glossary.html">Appendix A: Glossary</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust on ESP Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/esp-rs/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="installing-rust-for-espressif-socs"><a class="header" href="#installing-rust-for-espressif-socs">Installing Rust for Espressif SoCs</a></h1>
<h2 id="rust-installation"><a class="header" href="#rust-installation">Rust installation</a></h2>
<p>In order to develop applications for ESP devices using Rust you must first install the Rust compiler along with the appropriate toolchain and target(s). Depending on your device it may be one of two architectures, each requiring a different setup.</p>
<p>If you have not yet installed Rust on your system, you can do so easily using <a href="https://rustup.rs/">rustup</a>. For <em>macOS</em> and <em>Linux</em> it can be installed by running the following command:</p>
<pre><code class="language-bash">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
</code></pre>
<p>For installation on Windows or alternative installation methods, please refer to the instructions on the <a href="https://rustup.rs/">rustup</a> website.</p>
<p>If you are <a href="https://rust-lang.github.io/rustup/installation/windows.html">running Windows as your host operating system, you must also install one of the available ABIs</a>:</p>
<ul>
<li>MSVC: This is the recommended ABI. When installing <code>rustup</code>, it will check if all the requirements are installed, and, if they are not, it allows the user to install them.</li>
<li>GNU: No checks are done in <code>rustup</code> and expect that the user takes care of properly installing it.</li>
</ul>
<h2 id="ldproxy"><a class="header" href="#ldproxy">ldproxy</a></h2>
<p><code>ldproxy</code> crate is required when building applications using the Rust standard library, <code>std</code>. To install:</p>
<pre><code class="language-sh">cargo install ldproxy
</code></pre>
<p>This tool is required for <code>std</code> applications regardless of the target architecture.</p>
<h2 id="risc-v"><a class="header" href="#risc-v">RISC-V</a></h2>
<p>If you only want to target <code>RISC-V</code> chips, installation is simpler. In order to build
applications for <code>RISC-V</code> targets we need to use a <a href="https://rust-lang.github.io/rustup/concepts/channels.html#working-with-nightly-rust">Rust nightly toolchain</a> with the <code>rust-src</code> <a href="https://rust-lang.github.io/rustup/concepts/components.html">component</a>, both things can be installed with:</p>
<pre><code class="language-bash">rustup toolchain install nightly --component rust-src
</code></pre>
<p>There are two suitable targets for this chip:</p>
<ul>
<li>For bare-metal (<code>no_std</code>) applications, use <code>riscv32imc-unknown-none-elf</code></li>
<li>For applications that require <code>std</code>, use <code>riscv32imc-esp-espidf</code></li>
</ul>
<p>The bare-metal target can be installed by running:</p>
<pre><code class="language-bash">rustup target add riscv32imc-unknown-none-elf
</code></pre>
<p>For <code>std</code> applications, the <code>riscv32imc-esp-espidf</code> target is currently <a href="https://doc.rust-lang.org/nightly/rustc/platform-support.html#tier-3">Tier 3</a> and does not have prebuilt objects distributed through rustup, therefore, it does not need to be installed as <code>riscv32imc-unknown-none-elf</code>. The <code>-Z build-std</code> <a href="https://doc.rust-lang.org/cargo/reference/unstable.html">unstable cargo feature</a> is required within your project, this <a href="https://doc.rust-lang.org/cargo/reference/unstable.html">unstable cargo feature</a> can also be added to <code>.cargo/config.toml</code> of your project. Our <a href="../writing-your-own-application/generate-project-from-template.html">template projects</a>, which we will later discuss, already takes care of this.</p>
<p>Also, when building <code>std</code> applications, make sure you have <a href="https://llvm.org/"><code>LLVM</code></a> and <a href="#ldproxy"><code>ldproxy</code></a> installed. ESP-IDF will be installed by <a href="https://github.com/esp-rs/esp-idf-sys"><code>esp-idf-sys</code></a> altough you can also use an existing installation, see <a href="#a-note-in-esp-idf-installation">ESP-IDF installation note</a>.</p>
<p>At this point, you are ready to build applications for all the Espressif chips based on RISC-V architecture.</p>
<p>The installation of Rust for ESP <code>RISC-V</code> targets can also be handled by <code>espup</code>, a tool that will be introduced
in the <a href="#espup"><code>espup</code> section</a>.</p>
<h2 id="xtensa"><a class="header" href="#xtensa">Xtensa</a></h2>
<p>Because there is no <code>Xtensa</code> support in the mainline Rust compiler you must use the <a href="https://github.com/esp-rs/rust">esp-rs/rust</a> fork instead. There are a few options available for installing this compiler fork.</p>
<ul>
<li>The recommended one is using <a href="https://github.com/esp-rs/espup">esp-rs/espup</a>. See <a href="#espup"><code>espup</code> section</a> for more details.</li>
<li>Using <a href="https://github.com/esp-rs/rust-build">esp-rs/rust-build</a> installation scripts. This was the recommended way in the past, but now, the installation scripts are feature frozen and all the new features will only be included in <code>espup</code>. See the repository readme for instructions.</li>
<li>Building the Rust compiler with <code>Xtensa</code> support from source. This process is computationally expensive and can take one or more hours to complete depending on your system, for this reason, is not recommended unless there is a major reason to go for this approach. See instructions in the <a href="https://github.com/esp-rs/rust#installing-from-source">Installing from Source section of the esp-rs/rust repository</a>.</li>
</ul>
<h2 id="espup"><a class="header" href="#espup">espup</a></h2>
<p><a href="https://github.com/esp-rs/espup">esp-rs/espup</a> is a tool for installing and maintaining the required ecosystem to develop applications in Rust for Espressif SoC's (both <code>Xtensa</code> and <code>RISC-V</code> targets).</p>
<p><code>espup</code> takes care of installing the proper Rust compiler (our fork in case of <code>Xtensa</code> targets, and the <code>nightly</code> toolchain with the necessary target for <code>RISC-V</code> targets), <code>LLVM</code> toolchain,  <code>GCC</code> toolchains, and many other things. For more details, <a href="https://github.com/esp-rs/espup#usage">see Usage section of the <code>espup</code> Readme</a>.</p>
<p>In order to install <code>espup</code>:</p>
<pre><code class="language-sh">cargo install espup
</code></pre>
<p>It's also possible to directly download the pre-compiled <a href="https://github.com/esp-rs/espup/releases">release binaries</a> or to use <a href="https://github.com/cargo-bins/cargo-binstall">cargo-binstall</a>.</p>
<p>Once that <code>espup</code> is installed you can simply run:</p>
<pre><code class="language-sh">espup install
</code></pre>
<p>And it will install all the necessary tools to develop Rust applications for all supported ESP targets.</p>
<p><code>espup</code> will create and export file, by default called <code>export-esp.sh</code> on Unix systems
and <code>export-esp.ps1</code> on Windows, this file contains the required environment variables. Please, make sure to source in every terminal before building any application:</p>
<pre><code class="language-sh"># Unix
. $HOME/export-esp.sh
# Windows
%USERPROFILE%\export-esp.ps1
</code></pre>
<blockquote>
<h4 id="a-note-in-esp-idf-installation"><a class="header" href="#a-note-in-esp-idf-installation">A note in ESP-IDF installation.</a></h4>
<p>We already mentioned that <a href="index.html">ESP-IDF is required</a> when building <code>std</code> applications but, so far, no
instructions on how to install ESP-IDF have been mentioned. That is because <a href="https://github.com/esp-rs/esp-idf-sys"><code>esp-idf-sys</code></a>, a crate that all <code>std</code> applications
will use, already takes care of installing the necessary ESP-IDF version. <a href="https://github.com/esp-rs/esp-idf-sys#esp_idf_tools_install_dir-esp_idf_tools_install_dir">By default, this installation will take place under an <code>.embuild</code> folder</a> inside
the project directory.</p>
<p><code>espup install</code> has a <code>--espidf-version</code> option that allows installing the desired ESP-IDF version, see <a href="https://github.com/esp-rs/espup#install-subcommand">Install subcommand instructions</a>. When using this argument:</p>
<ul>
<li><code>ldproxy</code> will be installed if not present already.</li>
<li>The export file will include the necessary environment variables for ESP-IDF</li>
<li>When building <code>std</code> applications that use the installed version of ESP-IDF, <code>esp-idf-sys</code> will recognize there is an activated ESP-IDF environment
and will use it instead of downloading and installing it.
<ul>
<li>This is very helpful when we want to build several projects with the same ESP-IDF version as it saves time and space.</li>
<li>Be aware that if you source the environment with an ESP-IDF version and you try to build and <code>std</code> application that uses a different version it will fail to build.</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="using-containers"><a class="header" href="#using-containers">Using Containers</a></h2>
<p>As an alternative to installing the compiler fork to your local system directly, it's also possible to run it inside of a container.</p>
<p>A number of container runtimes are available, and which should be used depends on your operating system. Some of the popular options are:</p>
<ul>
<li><a href="https://www.docker.com/">Docker</a> (non-commercial use only without a license)</li>
<li><a href="https://podman.io/">Podman</a></li>
<li><a href="https://github.com/lima-vm/lima">Lima</a></li>
</ul>
<p>Espressif provides the <a href="https://hub.docker.com/r/espressif/idf-rust/tags">idf-rust</a> container image which contains several tags (generated both for <code>linux/arm64</code> and <code>linux/amd64</code>) for every Rust release:</p>
<ul>
<li>For <code>std</code> applications, the following naming convention is applied: <code>&lt;chip&gt;_&lt;esp-idf-version&gt;_&lt;rust-toolchain-version&gt;</code> . E.g., <a href="https://hub.docker.com/layers/espressif/idf-rust/esp32s3_v4.4_1.64.0.0/images/sha256-6fa1e98d770e3edc67cbd565893aa04e5573024b1e3e373fae50907435e841e4?context=explore"><code>esp32s3_v4.4_1.64.0.0</code></a> contains the ecosystem for developing <code>std</code> applications based on <a href="https://github.com/espressif/esp-idf/tree/release/v4.4">ESP-IDF release/v4.4</a> for <code>ESP32-S3</code> with the <code>1.64.0.0</code> Rust toolchain.</li>
<li>For <code>no_std</code> applications, the naming convention is: <code>&lt;chip&gt;_&lt;rust-toolchain-version&gt;</code>. E.g., <a href="https://hub.docker.com/layers/espressif/idf-rust/esp32_1.64.0.0/images/sha256-cc026ff9278a876f171d48978988e131940c07659485937a37cf750c44b28dfd?context=explore"><code>esp32_1.64.0.0</code></a> contains the ecosystem for developing <code>non_std</code> applications for <code>ESP32</code> with the <code>1.64.0.0</code> Rust toolchain.</li>
</ul>
<p>There is an <code>all</code> <code>&lt;chip&gt;</code> for both <code>std</code> and <code>no_std</code> tags that contains the environment required for all the ESP targets.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../installation/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../installation/troubleshooting.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../installation/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../installation/troubleshooting.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../assets/mermaid.min.js"></script>
        <script src="../assets/mermaid-init.js"></script>


    </body>
</html>
