<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rust on ESP targets - The Rust on ESP Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="A comprehensive guide on using the Rust programming language with Espressif SoCs and modules">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../overview/index.html"><strong aria-hidden="true">2.</strong> Ecosystem Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../overview/using-the-standard-library.html"><strong aria-hidden="true">2.1.</strong> Using the Standard Library (std)</a></li><li class="chapter-item expanded "><a href="../overview/bare-metal.html"><strong aria-hidden="true">2.2.</strong> Bare Metal (no_std)</a></li><li class="chapter-item expanded "><a href="../overview/comparing-std-and-no_std.html"><strong aria-hidden="true">2.3.</strong> Comparing std and no_std</a></li></ol></li><li class="chapter-item expanded "><a href="../installation/index.html" class="active"><strong aria-hidden="true">3.</strong> Rust on ESP targets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../installation/installation.html"><strong aria-hidden="true">3.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../installation/troubleshooting.html"><strong aria-hidden="true">3.2.</strong> Troubleshooting</a></li></ol></li><li class="chapter-item expanded "><a href="../tooling/index.html"><strong aria-hidden="true">4.</strong> Tooling</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tooling/text-editors-and-ides.html"><strong aria-hidden="true">4.1.</strong> Text Editors and IDEs</a></li><li class="chapter-item expanded "><a href="../tooling/espflash.html"><strong aria-hidden="true">4.2.</strong> espflash</a></li><li class="chapter-item expanded "><a href="../tooling/espmonitor.html"><strong aria-hidden="true">4.3.</strong> espmonitor</a></li><li class="chapter-item expanded "><a href="../tooling/debugging/index.html"><strong aria-hidden="true">4.4.</strong> Debugging</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tooling/debugging/probe-rs.html"><strong aria-hidden="true">4.4.1.</strong> probe-rs</a></li><li class="chapter-item expanded "><a href="../tooling/debugging/openocd.html"><strong aria-hidden="true">4.4.2.</strong> OpenOCD</a></li><li class="chapter-item expanded "><a href="../tooling/debugging/vscode-debugging.html"><strong aria-hidden="true">4.4.3.</strong> Debugging in Visual Studio Code</a></li></ol></li><li class="chapter-item expanded "><a href="../tooling/simulating/index.html"><strong aria-hidden="true">4.5.</strong> Simulating</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tooling/simulating/wokwi.html"><strong aria-hidden="true">4.5.1.</strong> Wokwi</a></li><li class="chapter-item expanded "><a href="../tooling/simulating/qemu.html"><strong aria-hidden="true">4.5.2.</strong> QEMU</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../writing-your-own-application/index.html"><strong aria-hidden="true">5.</strong> Writing Your Own Application</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing-your-own-application/generate-project-from-template.html"><strong aria-hidden="true">5.1.</strong> Generating Projects from Templates</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/index.html"><strong aria-hidden="true">5.2.</strong> Writing no_std Applications</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/understanding-esp-template.html"><strong aria-hidden="true">5.2.1.</strong> Understanding esp-template</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/hello-world.html"><strong aria-hidden="true">5.2.2.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/panic.html"><strong aria-hidden="true">5.2.3.</strong> Panic!</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/blinky.html"><strong aria-hidden="true">5.2.4.</strong> Blinky</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/button.html"><strong aria-hidden="true">5.2.5.</strong> Detect a button press</a></li><li class="chapter-item expanded "><a href="../writing-your-own-application/no-std-applications/interrupt.html"><strong aria-hidden="true">5.2.6.</strong> Detect a button press with interrupt</a></li></ol></li><li class="chapter-item expanded "><a href="../writing-your-own-application/std-applications/index.html"><strong aria-hidden="true">5.3.</strong> Writing std Applications</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing-your-own-application/std-applications/understanding-esp-idf-template.html"><strong aria-hidden="true">5.3.1.</strong> Understanding esp-idf-template</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../resources.html"><strong aria-hidden="true">6.</strong> Resources</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../misc/glossary.html">Appendix A: Glossary</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust on ESP Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/esp-rs/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rust-on-esp-targets"><a class="header" href="#rust-on-esp-targets">Rust on ESP targets</a></h1>
<p>With an understanding of the ecosystem surrounding Rust on Espressif chips, we can move on to actual development. If you are not aware of the two possible development approaches or do not understand the differences between writing <code>std</code> and <code>no_std</code> applications, please first read the <a href="../overview/index.html">Ecosystem Overview</a> chapter.</p>
<p>Let's take a moment to discuss the Rust support for the architectures of the Espressif chips in more detail. At this moment, Espressif SoCs are based on two different architectures: <code>RISC-V</code> and <code>Xtensa</code>. The support for those two architectures in the Rust programming language is very different.</p>
<h2 id="rust-in-risc-v-targets"><a class="header" href="#rust-in-risc-v-targets">Rust in RISC-V targets</a></h2>
<p>The <code>RISC-V</code> architecture has support in the mainline Rust compiler so setup is relatively simple, all we must do is add the appropriate compilation target.</p>
<p>Hence, the dependencies required to develop Rust applications in <code>RISC-V</code> targets are:</p>
<ul>
<li>Rust Toolchain with the proper target: Used to compile our Rust code.</li>
<li><code>LLVM</code>: Used as codegen backend by the Rust compiler.</li>
<li>[<em>Optional</em>] <code>GCC</code> Toolchain: <code>GCC</code> linker can be used.
<ul>
<li><code>GCC</code> is marked as optional as you can also use <code>LLVM</code> linker.</li>
</ul>
</li>
</ul>
<p>Aditonally when building <code>std</code> applications we also need:</p>
<ul>
<li><a href="https://github.com/espressif/esp-idf">ESP-IDF</a>: Espressif IoT Development Framework.</li>
<li><a href="https://github.com/esp-rs/embuild/tree/master/ldproxy"><code>ldproxy</code></a> crate:  Simple tool to forward linker arguments given to <a href="https://github.com/esp-rs/embuild/tree/master/ldproxy"><code>ldproxy</code></a> to the actual linker executable. The crate can be found in the <a href="https://github.com/esp-rs/embuild">esp-rs/embuild</a> repository.</li>
</ul>
<h2 id="rust-in-xtensa-targets"><a class="header" href="#rust-in-xtensa-targets">Rust in Xtensa targets</a></h2>
<p>To this day, there is no <code>Xtensa</code> support in the mainline Rust compiler, for this reason, we maintain the <a href="https://github.com/esp-rs/rust">esp-rs/rust</a> fork that adds support for our <code>Xtensa</code> targets.</p>
<p><code>Xtensa</code> not being supported on Rust mainline is mainly a consequence of <code>LLVM</code> not supporting <code>Xtensa</code> targets. For that reason, we also maintain an LLVM fork with support for Espressif <code>Xtensa</code> targets in <a href="https://github.com/espressif/llvm-project">espressif/llvm-project</a></p>
<p>Another consequence of <code>LLVM</code> not suporting our <code>Xtensa</code> targets is that we need to provide our own linker. I.e. we'll need to install <a href="https://github.com/espressif/crosstool-NG/">GCC toolchain</a> to use it as our linker.</p>
<blockquote>
<h4 id="a-note-in-upstreaming-our-forks"><a class="header" href="#a-note-in-upstreaming-our-forks">A note in upstreaming our forks.</a></h4>
<p>We are trying to upstream the changes in both our <code>LLVM</code> and Rust forks.
The first step is to upstream the <code>LLVM</code> project, this is already in progress
and you can see the status at this <a href="https://github.com/espressif/llvm-project/issues/4">tracking issue</a>.
If our <code>LLVM</code> changes are accepted in <code>LLVM</code> mainline, we will proceed with trying
to upstream the Rust compiler changes.</p>
</blockquote>
<p>The forked compiler can coexist with the standard Rust compiler, so it is possible to have both installed on your system. The forked compiler is invoked when using the <code>esp</code> <a href="https://rust-lang.github.io/rustup/concepts/channels.html">channel</a> instead of the defaults, <code>stable</code> or <code>nightly</code>.</p>
<p>Hence, the dependencies required to develop Rust applications in <code>Xtensa</code> targets are:</p>
<ul>
<li>Rust Toolchain: Used to compile our Rust code.
<ul>
<li><em>We need to use our custom fork with <code>Xtensa</code> support</em>.</li>
</ul>
</li>
<li><code>LLVM</code>: Used as codegen backend by the Rust compiler.
<ul>
<li><em>We need to use our custom fork with <code>Xtensa</code> support</em>.</li>
</ul>
</li>
<li><code>GCC</code> Toolchain: <code>GCC</code> linker is used in our Rust applications as it supports all our targets architectures (<code>Xtensa</code> and <code>RISC-V</code>).</li>
</ul>
<p>Aditonally when building <code>std</code> applications we also need:</p>
<ul>
<li><a href="https://github.com/espressif/esp-idf">ESP-IDF</a>: Espressif IoT Development Framework.</li>
<li><a href="https://github.com/esp-rs/embuild/tree/master/ldproxy"><code>ldproxy</code></a> crate:  Simple tool to forward linker arguments given to <a href="https://github.com/esp-rs/embuild/tree/master/ldproxy"><code>ldproxy</code></a> to the actual linker executable. The crate can be found in the <a href="https://github.com/esp-rs/embuild">esp-rs/embuild</a> repository.</li>
</ul>
<p>This chapter, will cover how to properly install the correct Rust compiler and toolchain for our ESP chips.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../overview/comparing-std-and-no_std.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../installation/installation.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../overview/comparing-std-and-no_std.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../installation/installation.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../assets/mermaid.min.js"></script>
        <script src="../assets/mermaid-init.js"></script>


    </body>
</html>
